(function(Backbone,_,$){"use strict";var Typeahead=function(models,options){if(_.isArray(models)){models=models.slice(0);if(!_.isObject(options)){options={}}}else if(_.isObject(models)){options=models}else{throw new Error("A typeahead must be created with either initial models or have its collection specified in an options object")}this.preInitialize.call(this,models,options);Backbone.View.call(this,options);this.postInitialize.call(this)};Typeahead.VERSION="0.2.1";Typeahead.extend=Backbone.View.extend;Typeahead.ItemView=Backbone.View.extend({tagName:"li",className:"typeahead-item",events:{click:"selectItem",mouseover:"activateItem"},initialize:function(options){this.parent=options.parent},render:function(){this.$el.html(_.template(this.template)(this.model.toJSON()));return this},selectItem:function(){this.parent.selectModel(this.model)},activateItem:function(){this.parent.activateModel(this.model)}});_.extend(Typeahead.prototype,Backbone.View.prototype,{preInitialize:function(models,options){options.key=options.key||"name";options.limit=options.limit||8;if(_.isUndefined(options.collection)&&_.isArray(models)){options.collection=new Backbone.Collection(models,options)}this.view=options.view;if(_.isUndefined(this.view)){this.view=Typeahead.ItemView.extend({template:options.itemTemplate||"<a><%- "+options.key+" %></a>"})}this.events=_.extend({},this.nativeEvents,_.result(this,"events"));this.options=options},postInitialize:function(){this.results=[];this.focused=false;this.shown=false;this.mousedover=false},template:'<input type="text" class="form-control" placeholder="Search" /><ul class="dropdown-menu"></ul>',nativeEvents:{keyup:"keyup",keypress:"keypress",keydown:"keydown","blur input":"blur","focus input":"focus",mouseenter:"mouseenter",mouseleave:"mouseleave"},render:function(){this.$el.html(this.template);this.$menu=this.$("ul");this.$input=this.$("input");return this},rerender:function(models){this.$menu.empty();_.each(models,this.renderModel,this);models.length?this.show():this.hide()},renderModel:function(model){this.$menu.append(new this.view({model:model,parent:this}).render().el)},search:function(value){var sanitizedValue=value.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var re=new RegExp(sanitizedValue,"i");var key=this.options.key;return this.collection.filter(function(model){return re.test(model.get(key))})},clearInput:function(){this.$input.val("")},searchInput:function(){this.results=this.search(this.$input.val()).slice(0,this.options.limit);this.rerender(this.results)},select:function(){var index=this.$menu.find(".active").index();this.selectModel(this.results[index])},selectModel:function(model){this.$input.val(model.get(this.options.key));this.hide();this.trigger("selected",model,this.collection);this.results=[]},activateModel:function(){this.$menu.find(".active").removeClass("active")},keyup:function(evt){switch(evt.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 13:if(!this.shown){return}this.select();break;case 27:if(!this.shown){return}this.hide();break;default:this.searchInput()}evt.stopPropagation();evt.preventDefault()},focus:function(){this.focused=true;if(!this.shown){this.show()}},blur:function(){this.focused=false;if(!this.mousedover&&this.shown){this.hide()}},mouseenter:function(){this.mousedover=true},mouseleave:function(){this.mousedover=false;if(!this.focused&&this.shown){this.hide()}},keydown:function(evt){this.suppressKeyPressRepeat=~$.inArray(evt.keyCode,[40,38,9,13,27]);this.move(evt)},keypress:function(evt){if(this.suppressKeyPressRepeat){return}this.move(evt)},move:function(evt){if(!this.shown){return}switch(evt.keyCode){case 9:case 13:case 27:evt.preventDefault();break;case 38:evt.preventDefault();this.prevItem();break;case 40:evt.preventDefault();this.nextItem();break}evt.stopPropagation()},prevItem:function(){var active=this.$menu.find(".active").removeClass("active");var prev=active.prev();if(!prev.length){prev=this.$menu.find("li").last()}prev.addClass("active")},nextItem:function(){var active=this.$menu.find(".active").removeClass("active");var next=active.next();if(!next.length){next=this.$menu.find("li").first()}next.addClass("active")},show:function(){if(!this.results.length){return}var pos=$.extend({},this.$input.position(),{height:this.$input[0].offsetHeight});this.$menu.css({top:pos.top+pos.height,left:pos.left}).show();this.shown=true;return this},hide:function(){this.$menu.hide();this.shown=false;return this}});Backbone.Typeahead=Typeahead})(Backbone,_,$);
//# sourceMappingURL=backbone.typeahead.min.js.map